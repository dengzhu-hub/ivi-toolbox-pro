# 🚗 IVI Toolbox Pro (V20.1-CONFIG-FINAL)

> **工业级车载 Android 系统全栈测试与运维平台**
>
> **开发者**: Jonas (GitHub: [dengzhu-hub](https://github.com/dengzhu-hub))
> **版本**: V20.1 (最终交付版 / Project Freeze)
> **适用平台**: Windows 10/11 (原生支持), macOS/Linux (兼容)

---

## 📖 1. 项目简介 (Introduction)

**IVI Toolbox Pro** 是一款专为车载信息娱乐系统 (IVI) 研发与测试工程师打造的 **All-in-One 命令行工具**。

它摒弃了传统 ADB 命令行繁琐、枯燥的操作体验，基于 Python `Rich` 库构建了现代化的 TUI (文本用户界面)。工具集成了 **智能提权、日志分析、性能监控、应用管理、OTA 配置、多媒体处理** 等 10+ 项核心功能模块，致力于实现“让测试更简单，让数据更直观，让运维更安全”。

**核心价值**：

- **可视化交互**：HUD 抬头显示 + 实时遥测仪表盘。
- **配置解耦**：所有敏感信息（Key/Password）剥离至外部 JSON，安全灵活。
- **工业级健壮性**：针对 Windows 平台深度优化，防崩溃、防乱码、自动重连。

---

## ⚡ 2. 快速开始 (Quick Start)

### 2.1 环境搭建

本工具基于 Python 开发，但为了方便分发，我们提供了 **源码运行** 和 **EXE 打包运行** 两种方式。

#### 方式 A：源码运行（推荐开发者）

1.  **安装 Python 3.8+**：请确保勾选 "Add Python to PATH"。
2.  **安装依赖库**：
    ```bash
    pip install rich requests pillow
    ```
3.  **运行工具**：
    ```bash
    python adb_gain_root.py
    ```

#### 方式 B：EXE 绿色版运行（推荐测试人员）

1.  获取发布的 ZIP 包，解压到任意目录。
2.  确保目录结构如下（包含 ADB 依赖）：
    ```text
    IVI_Toolbox_v20.1/
    ├── IVI_Toolbox_Pro.exe   <-- 双击运行
    ├── adb.exe
    ├── AdbWinApi.dll
    └── AdbWinUsbApi.dll
    ```
3.  **双击 exe 即可启动**，无需配置 Python 环境。

---

## 🛠️ 3. 核心功能矩阵 (Feature Matrix)

### 3.1 核心运维模块 (Core Operations)

| 功能项                           | 描述与亮点                                                                                                                                                                                                                                                                   |
| :------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **🚀 工程提权 (Smart Root)**     | • **智能混合策略**：自动尝试标准 Root -> 注入厂商密钥 (`adayo@N51`)。<br>• **全自动流水线**：一键执行 Root -> Disable Verity -> Reboot (智能判断) -> Remount -> SELinux Disable。<br>• **状态自检**：执行后自动校验 UID/Mount 状态，确保真正获得 RW 权限。                   |
| **📊 系统监控 (Sentinel)**       | • **智能兼容**：自动适配 Toybox/Busybox 的 `top` 命令格式。<br>• **双模式**：支持 **全量 Top 监控** 和 **白名单监控** (`whitelist.txt`)。<br>• **可视化**：实时刷新 CPU/MEM 仪表盘及高负载进程列表，拒绝命令行刷屏。                                                         |
| **📺 日志指挥中心 (Log Center)** | • **实时监控台**：类 Android Studio 的彩色日志流，支持 Tag/Level/Keyword/Exclude **四重过滤**。<br>• **后台录制**：支持 **自动分卷** (50MB/个)，防止日志文件过大无法打开。<br>• **一键导出**：自动拉取 `/mnt/sdcard/AdayoLog`、`/data/vendor/wifi`、OTA 日志并按时间戳归档。 |

### 3.2 应用与配置工具 (Apps & Config)

| 功能项                        | 描述与亮点                                                                                                                                                                                                                                                 |
| :---------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **🔧 OTA 参数配置**           | • **双向同步**：自动拉取车机 `DeviceInfo.txt`，支持 **JSON/KV** 格式自适应解析。<br>• **智能校验**：内置算法校验 VIN 码长度及非法字符。<br>• **原子推送**：修改后自动打包推送，防止格式错误导致 OTA 失败。                                                 |
| **🗑️ 应用管理 (App Manager)** | • **模糊搜索**：记不住包名？输入 `set` 即可搜到 `com.android.settings`。<br>• **分类浏览**：支持按 **User (三方)** / **System (系统)** 分类查看。<br>• **清单审计**：支持导出当前设备应用清单为 TXT 报告。                                                 |
| **⏱️ 性能测速 (Perf Master)** | • **智能嗅探**：自动识别应用启动 Activity，无需手动输入 Component Name。<br>• **多模式测速**：支持 **冷启动 (Cold)** 和 **热启动 (Hot)**，自动计算 Avg/Max/Min。<br>• **Activity 侦测**：独家算法穿透 HUD/SystemUI 遮挡，识别当前真实的 Resumed Activity。 |

### 3.3 多媒体与素材 (Multimedia)

| 功能项              | 描述与亮点                                                                                                                                                                                     |
| :------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **📸 专业截屏**     | • **多模式**：支持单次、连续 (连拍)、定时 (倒计时) 截屏。<br>• **后期处理**：支持添加 **水印** (设备 ID+时间)、**区域裁剪**。<br>• **依赖检测**：未安装 Pillow 库时自动降级，不崩馈。          |
| **🎥 屏幕录制**     | • **防崩溃设计**：通过发送 `SIGINT` 信号优雅结束录制，**彻底解决 MP4 文件头损坏无法播放的问题**。<br>• **高级参数**：支持自定义比特率和分辨率。                                                |
| **📥 素材采集中心** | • **多 Key 轮询**：集成 Unsplash API，自动切换 Key 应对配额限制。<br>• **全量图库**：内置 7 大类官方主题 (Car, Tech, Texture...)。<br>• **闭环测试**：下载完成后可直接推送到车机相册进行测试。 |
| **🎨 图片工厂**     | • **格式转换**：支持 JPG/PNG/BMP/TIFF/PDF 等互转。<br>• **WebP 优化**：Android 专用极致压缩模式，减小 APK 体积。<br>• **PDF 合成**：支持将多张截图合并为一个 PDF 测试报告。                    |

---

## ⚙️ 4. 配置文件说明 (Configuration)

首次运行后，工具会在根目录生成 `config.json`。实现**代码与配置解耦**。

```json
{
    "root_password": "adayo@N51",          // 提权用的厂商密钥
    "unsplash_keys": [                     // 素材下载用的 API Key 池
        "YOUR_ACCESS_KEY_1",
        "YOUR_ACCESS_KEY_2"
    ],
    "paths": {                             // 自定义存储路径
        "materials": "test_materials",
        "screenshots": "screenshots",
        "logs": "captured_logs"
    },
    "unsplash_catalog": { ... }            // 内置素材分类配置
}
```
