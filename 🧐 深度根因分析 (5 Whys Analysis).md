---

### 🧐 深度根因分析 (5 Whys Analysis)

**客户痛点**：截图工具只能截取右边的娱乐画面（Android），左边的仪表盘（QNX）截不到，变成黑的或者根本不在图片里。

*   **1. Why (为什么截不到左边)？**
    *   因为我们的工具使用的是 `adb shell screencap`。ADB (Android Debug Bridge) 是 Android 系统的调试桥，它只能访问 Android 系统管理的显存（FrameBuffer）。

*   **2. Why (为什么 Android 访问不到左边的显存)？**
    *   因为左边的仪表盘运行在 **QNX 系统** 上（出于功能安全 ISO 26262 的要求，仪表盘必须由实时操作系统 QNX 托管，保证 Android 死机时仪表盘依然能显示车速）。

*   **3. Why (它们在同一个屏幕上，为什么系统不互通)？**
    *   因为它们是通过 **Hypervisor (虚拟化)** 技术隔离的。就像一台电脑上同时运行 Windows 和 Linux 虚拟机。Android 是虚拟机 A，QNX 是虚拟机 B。**虚拟机 A（Android）在物理上没有权限读取虚拟机 B（QNX）的内存数据。**

*   **4. Why (那屏幕是怎么把它们拼在一起显示的)？**
    *   这是由底层的 **硬件显示控制器 (Hardware Display Controller / DC)** 或者 **Hypervisor 的图形合成器** 在**硬件层面**完成的拼接。当信号输送到物理屏幕时，它们才合体。而 ADB 工作在 Android 软件层，位于这个硬件合成层的“下游”，所以 ADB 根本“看不见”QNX 的画面。

*   **5. Why (结论是什么)？**
    *   **根本原因**：这是**系统架构级的物理安全隔离**。不是工具的 Bug，而是车机为了安全故意设计的壁垒。任何纯 Android 层的软件（包括市面上所有的 ADB 工具）都无法跨越这个壁垒去截取 QNX 的画面。

---

### 🛠️ 分级对策方案 (给 VIP 的解决方案)

#### 🟢 方案一：硬件采集法（推荐，最专业，无侵入）
这是车企和 Tier 1 供应商进行 **整机验收测试** 的标准做法。

* **原理**：不依赖内部软件，直接获取屏幕的 HDMI/FPD-Link 信号。

*   **做法**：
    1.  使用 **视频采集卡 (Capture Card)**（如 Elgato 或工业级采集卡）。
    2.  如果车机有 HDMI 输出口，直接插。
    3.  如果没有，使用 **FPD-Link 解串器** 并在硬件上引出视频信号。
    
    

#### 🟡 方案二：双链路拼接法（纯软件，需研发支持）
*   **原理**：分别在 QNX 和 Android 截图，然后拼起来。
*   **前提**：必须能通过 Telnet/SSH 连接到 QNX 系统。
*   **流程**：
    1.  工具通过 ADB 截取 Android 画面（右半部分）。
    2.  工具通过 Telnet/SSH 发送 QNX 的截图指令（如 `screen_capture`，具体命令取决于芯片厂商如高通/瑞萨）。
    3.  将 QNX 的截图拉取到电脑。
    4.  使用我们的 Python 工具（Pillow 库）将两张图**左右拼接**。

#### 🔴 方案三：虚拟机投屏法（仅限开发阶段）
*   **做法**：有些开发版车机（Userdebug版）在底层 Hypervisor 中提供了一个特殊的 Debug 接口，允许将整个 FrameBuffer 映射给 Android 的某个虚拟 Display。
*   **测试方法**：
    *   运行我们的工具，使用 **[6] 专业截屏工具 -> [1] 单次截屏**。
    *   我们的工具现在支持**多屏遍历**。如果开发版开启了映射，可能会在 Display ID 1 或 2 中抓取到完整画面。
    *   *注：这取决于 ROM 是否开启了该调试接口。*



> **关于双系统（QNX+Android）全屏截图的技术说明**
>
> **现象确认**：
> 当前截图仅包含 Android 娱乐屏内容，缺失左侧仪表盘（QNX）内容。
>
> **技术根因**：
> 您的车机采用了先进的 **Hypervisor 虚拟化架构**。
> *   **右侧 (Android)**：负责娱乐，通过 ADB 可完全控制。
> *   **左侧 (QNX)**：负责仪表与行车安全。根据 **ISO 26262 功能安全标准**，QNX 的显存与 Android 进行了**物理级内存隔离**。
> *   **结论**：Android 系统（及 ADB 工具）在底层被禁止访问 QNX 的画面数据，这是为了防止 Android 崩溃影响仪表显示的必要安全设计。
>
> **解决方案建议**：
> 1.  **标准验证方案（推荐）**：使用 **HDMI/视频采集卡** 进行外部物理录制。这是验证“人眼真实所见”的唯一无死角方案，完全覆盖所有系统层级。
> 2.  **软件定制方案**：如您具备 QNX 后台权限（SSH/Telnet IP），我们的工具支持**扩展开发**，可实现“Android + QNX 双通道同步截图并自动拼接”。
> 3.  **当前工具能力**：我们的工具已升级至 **v16.2**，支持遍历 Android 侧的所有逻辑屏幕。建议您尝试新版工具，排除是否为 Android 多屏投射模式。

---

